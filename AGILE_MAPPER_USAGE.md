# ?? AgileMapper Usage in WiFi QR Generator

## ?? Overview

This document explains how **AgileMapper** is used in the WiFi QR Generator project for object-to-object mapping.

---

## ?? What is AgileMapper?

**AgileMapper** is a powerful .NET object mapping library that automatically maps properties between different object types.

### **Benefits:**
- ? Reduces boilerplate code
- ? Type-safe mapping
- ? Convention-based (maps by property name)
- ? High performance
- ? Easy to configure custom mappings

---

## ??? Setup in Project

### **1. Interface: IObjectMapper**

```csharp
// Services/IObjectMapper.cs
namespace HomeWifiQR.Services;

public interface IObjectMapper
{
    TDestination Map<TDestination>(object source);
}
```

### **2. Implementation: AgileMapperAdapter**

```csharp
// Services/AgileMapperAdapter.cs
using AgileObjects.AgileMapper;
using AgileObjects.AgileMapper.Extensions;

namespace HomeWifiQR.Services;

public class AgileMapperAdapter : IObjectMapper
{
    public TDestination Map<TDestination>(object source) =>
        source.Map().ToANew<TDestination>();
}
```

### **3. Dependency Injection (Program.cs)**

```csharp
// Register AgileMapper
builder.Services.AddScoped<IObjectMapper, AgileMapperAdapter>();
```

---

## ?? Mappings in CreateWifiEndpoint

### **Mapping 1: CreateWifiRequest ? WifiNetwork**

**Purpose:** Map incoming API request to domain model

```csharp
// Input (DTO)
public class CreateWifiRequest
{
    public string Ssid { get; set; } = string.Empty;
    public string? Password { get; set; }
    public string Encryption { get; set; } = "WPA";
    public bool Hidden { get; set; }
}

// Output (Domain Model)
public class WifiNetwork
{
    public Guid Id { get; set; }  // Auto-generated, not from request
    public string Ssid { get; set; } = string.Empty;
    public string? Password { get; set; }
    public string Encryption { get; set; } = "WPA";
    public bool Hidden { get; set; }
}

// Usage in CreateWifiEndpoint
var wifiNetwork = _mapper.Map<WifiNetwork>(req);
// ? Ssid ? Ssid
// ? Password ? Password
// ? Encryption ? Encryption
// ? Hidden ? Hidden
// ? Id is left as default (Guid.Empty), will be generated by database
```

---

### **Mapping 2: WifiNetwork ? CreateWifiResponse**

**Purpose:** Map saved domain model to API response

```csharp
// Input (Domain Model)
public class WifiNetwork
{
    public Guid Id { get; set; }
    public string Ssid { get; set; } = string.Empty;
    public string? Password { get; set; }
    public string Encryption { get; set; } = "WPA";
    public bool Hidden { get; set; }
}

// Output (Response DTO)
public class CreateWifiResponse
{
    public Guid Id { get; set; }
    public string Ssid { get; set; } = string.Empty;
    public string? Password { get; set; }
    public string Encryption { get; set; } = "WPA";
    public bool Hidden { get; set; }
}

// Usage in CreateWifiEndpoint
var response = _mapper.Map<CreateWifiResponse>(created);
// ? Id ? Id
// ? Ssid ? Ssid
// ? Password ? Password
// ? Encryption ? Encryption
// ? Hidden ? Hidden
```

---

### **Mapping 3: WifiNetwork ? WifiQrCreatedMessage (Manual)**

**Purpose:** Create SQS message from domain model

**Why Manual?** Property name mismatch: `Id` vs `WifiId`

```csharp
// Input (Domain Model)
public class WifiNetwork
{
    public Guid Id { get; set; }  // ? Different name
    public string Ssid { get; set; }
    public string Encryption { get; set; }
    public bool Hidden { get; set; }
}

// Output (SQS Message)
public class WifiQrCreatedMessage
{
    public Guid WifiId { get; set; }  // ? Different name!
    public string Ssid { get; set; }
    public string Encryption { get; set; }
    public bool Hidden { get; set; }
    public DateTime CreatedAt { get; set; }
    public string CreatedBy { get; set; }
}

// Manual mapping required
var message = new WifiQrCreatedMessage
{
    WifiId = created.Id,  // Manual: Id ? WifiId
    Ssid = created.Ssid,
    Encryption = created.Encryption,
    Hidden = created.Hidden,
    CreatedAt = DateTime.UtcNow,
    CreatedBy = User?.Identity?.Name ?? "System"
};
```

---

## ?? Complete CreateWifiEndpoint Flow

```
???????????????????????????????????????????????????????????????
? 1. Request Arrives                                           ?
???????????????????????????????????????????????????????????????
? POST /api/wifi                                               ?
? Body: CreateWifiRequest                                      ?
? {                                                            ?
?   "ssid": "MyHomeWiFi",                                     ?
?   "password": "SecurePass123",                              ?
?   "encryption": "WPA2",                                     ?
?   "hidden": false                                           ?
? }                                                            ?
???????????????????????????????????????????????????????????????
                         ?
                         ? AgileMapper
???????????????????????????????????????????????????????????????
? 2. Map to Domain Model                                       ?
???????????????????????????????????????????????????????????????
? var wifiNetwork = _mapper.Map<WifiNetwork>(req);            ?
?                                                              ?
? Result: WifiNetwork                                          ?
? {                                                            ?
?   Id: 00000000-0000-0000-0000-000000000000 (default)       ?
?   Ssid: "MyHomeWiFi",                                       ?
?   Password: "SecurePass123",                                ?
?   Encryption: "WPA2",                                       ?
?   Hidden: false                                             ?
? }                                                            ?
???????????????????????????????????????????????????????????????
                         ?
                         ? Database Save
???????????????????????????????????????????????????????????????
? 3. Save to Database                                          ?
???????????????????????????????????????????????????????????????
? var created = await _wifiService.CreateAsync(wifiNetwork);  ?
?                                                              ?
? Result: WifiNetwork (with generated Id)                     ?
? {                                                            ?
?   Id: 550e8400-e29b-41d4-a716-446655440000 (generated!)    ?
?   Ssid: "MyHomeWiFi",                                       ?
?   Password: "SecurePass123",                                ?
?   Encryption: "WPA2",                                       ?
?   Hidden: false                                             ?
? }                                                            ?
???????????????????????????????????????????????????????????????
                         ?
                         ? Manual Mapping
???????????????????????????????????????????????????????????????
? 4. Create SQS Message (Manual)                              ?
???????????????????????????????????????????????????????????????
? var message = new WifiQrCreatedMessage                      ?
? {                                                            ?
?     WifiId = created.Id,  // ? Manual mapping               ?
?     Ssid = created.Ssid,                                    ?
?     Encryption = created.Encryption,                        ?
?     Hidden = created.Hidden,                                ?
?     CreatedAt = DateTime.UtcNow,                            ?
?     CreatedBy = User?.Identity?.Name ?? "System"            ?
? };                                                           ?
?                                                              ?
? await _sqsService.SendMessageAsync(message);                ?
???????????????????????????????????????????????????????????????
                         ?
                         ? AgileMapper
???????????????????????????????????????????????????????????????
? 5. Map to Response                                           ?
???????????????????????????????????????????????????????????????
? var response = _mapper.Map<CreateWifiResponse>(created);    ?
?                                                              ?
? Result: CreateWifiResponse                                   ?
? {                                                            ?
?   Id: 550e8400-e29b-41d4-a716-446655440000,                ?
?   Ssid: "MyHomeWiFi",                                       ?
?   Password: "SecurePass123",                                ?
?   Encryption: "WPA2",                                       ?
?   Hidden: false                                             ?
? }                                                            ?
???????????????????????????????????????????????????????????????
                         ?
                         ? Return to Client
???????????????????????????????????????????????????????????????
? 6. HTTP Response 201 Created                                ?
???????????????????????????????????????????????????????????????
? {                                                            ?
?   "id": "550e8400-e29b-41d4-a716-446655440000",            ?
?   "ssid": "MyHomeWiFi",                                     ?
?   "password": "SecurePass123",                              ?
?   "encryption": "WPA2",                                     ?
?   "hidden": false                                           ?
? }                                                            ?
???????????????????????????????????????????????????????????????
```

---

## ?? Code Comparison

### **Before AgileMapper (Manual Mapping):**

```csharp
public override async Task HandleAsync(CreateWifiRequest req, CancellationToken ct)
{
    // Manual mapping - repetitive and error-prone
    var wifiNetwork = new WifiNetwork
    {
        Ssid = req.Ssid,
        Password = req.Password,
        Encryption = req.Encryption,
        Hidden = req.Hidden
    };

    var created = await _wifiService.CreateAsync(wifiNetwork, ct);

    // Manual mapping again
    await SendAsync(new CreateWifiResponse
    {
        Id = created.Id,
        Ssid = created.Ssid,
        Password = created.Password,
        Encryption = created.Encryption,
        Hidden = created.Hidden
    }, cancellation: ct);
}
```

**Lines of code:** ~20  
**Maintainability:** ? Error-prone (forget a property?)  
**Scalability:** ? More properties = more code

---

### **After AgileMapper (Automatic Mapping):**

```csharp
public override async Task HandleAsync(CreateWifiRequest req, CancellationToken ct)
{
    // One-line mapping ?
    var wifiNetwork = _mapper.Map<WifiNetwork>(req);

    var created = await _wifiService.CreateAsync(wifiNetwork, ct);

    // One-line mapping ?
    var response = _mapper.Map<CreateWifiResponse>(created);
    await SendAsync(response, cancellation: ct);
}
```

**Lines of code:** ~8  
**Maintainability:** ? Type-safe, automatic  
**Scalability:** ? More properties? No problem!

---

## ?? When to Use AgileMapper vs Manual Mapping

### **? Use AgileMapper When:**

- Property names match exactly
- Simple one-to-one mappings
- No complex transformations needed
- Want to reduce boilerplate code

**Examples:**
```csharp
? CreateWifiRequest ? WifiNetwork
? WifiNetwork ? CreateWifiResponse
? WifiNetwork ? WifiNetworkResponse
```

---

### **?? Use Manual Mapping When:**

- Property names differ (`Id` vs `WifiId`)
- Need custom logic during mapping
- Conditional mappings
- Calculated properties

**Examples:**
```csharp
? WifiNetwork ? WifiQrCreatedMessage (Id ? WifiId)
? Adding CreatedAt, CreatedBy fields
? Complex transformations
```

---

## ?? Benefits Achieved

### **1. Reduced Code:**
```
Manual Mapping: ~15 lines per endpoint
AgileMapper: ~2 lines per endpoint
Savings: ~85% less code! ??
```

### **2. Type Safety:**
```csharp
// AgileMapper catches type mismatches at compile time
var response = _mapper.Map<CreateWifiResponse>(created);
// ? Compile error if types don't match
```

### **3. Maintainability:**
```csharp
// Add new property to WifiNetwork
public class WifiNetwork
{
    // ... existing properties
    public string? Description { get; set; }  // ? New!
}

// Add to CreateWifiRequest
public class CreateWifiRequest
{
    // ... existing properties
    public string? Description { get; set; }  // ? New!
}

// AgileMapper automatically maps it! ?
// No code changes needed in CreateWifiEndpoint!
```

### **4. Performance:**
```
AgileMapper uses compiled expressions:
- First mapping: ~1ms (compilation)
- Subsequent mappings: ~0.001ms (cached)
- Negligible overhead compared to manual mapping
```

---

## ?? Additional Resources

- **AgileMapper Documentation:** https://github.com/agileobjects/AgileMapper
- **NuGet Package:** `AgileObjects.AgileMapper`
- **Similar Libraries:**
  - AutoMapper (more features, heavier)
  - Mapster (fastest)
  - Manual mapping (full control)

---

## ?? Summary

**AgileMapper in CreateWifiEndpoint:**
- ? **Request ? Domain:** `_mapper.Map<WifiNetwork>(req)`
- ? **Domain ? Response:** `_mapper.Map<CreateWifiResponse>(created)`
- ?? **Domain ? SQS Message:** Manual (property name mismatch)

**Benefits:**
- ? 85% less mapping code
- ? Type-safe
- ? Maintainable
- ? High performance

**Your project now uses industry-standard object mapping!** ??
