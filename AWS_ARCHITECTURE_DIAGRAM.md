# ?? AWS SQS + Lambda Architecture Diagram

```
???????????????????????????????????????????????????????????????????????????????
?                         CLIENT APPLICATION                                   ?
?  ??????????????????????????????????????????????????????????????????????    ?
?  ?  React Frontend (localhost:5173)                                   ?    ?
?  ?  - User creates WiFi QR code                                       ?    ?
?  ??????????????????????????????????????????????????????????????????????    ?
???????????????????????????????????????????????????????????????????????????????
                                             ?
                                             ? HTTP POST /api/wifi
                                             ? (JWT Authentication)
                                             ?
???????????????????????????????????????????????????????????????????????????????
?                         .NET 8 API (FastEndpoints)                          ?
?  ??????????????????????????????????????????????????????????????????????    ?
?  ?  CreateWifiEndpoint                                                 ?    ?
?  ?  ?? Validate request (FluentValidation)                            ?    ?
?  ?  ?? Create WiFi network entity                                     ?    ?
?  ?  ?? Save to SQL Server                                             ?    ?
?  ?  ?? Generate QR code                                               ?    ?
?  ?  ?? Send message to SQS ? NEW!                                     ?    ?
?  ??????????????????????????????????????????????????????????????????????    ?
?  ??????????????????????????????????????????????????????????????????????    ?
?  ?  SqsService                                                         ?    ?
?  ?  - Serialize message to JSON                                       ?    ?
?  ?  - Add metadata                                                     ?    ?
?  ?  - Send via AWS SDK                                                ?    ?
?  ??????????????????????????????????????????????????????????????????????    ?
???????????????????????????????????????????????????????????????????????????????
                                             ?
                                             ? AWS SDK (AWSSDK.SQS)
                                             ? Message: WifiQrCreatedMessage
                                             ?
???????????????????????????????????????????????????????????????????????????????
?                         AMAZON SQS QUEUE                                     ?
?  ??????????????????????????????????????????????????????????????????????    ?
?  ?  Queue: wifi-qr-queue                                              ?    ?
?  ?  Type: Standard (or FIFO)                                          ?    ?
?  ?  Region: us-east-1                                                 ?    ?
?  ?                                                                      ?    ?
?  ?  Message Body (JSON):                                              ?    ?
?  ?  {                                                                  ?    ?
?  ?    "wifiId": "550e8400-e29b-41d4-a716-446655440000",              ?    ?
?  ?    "ssid": "MyWiFi",                                               ?    ?
?  ?    "encryption": "WPA2",                                           ?    ?
?  ?    "hidden": false,                                                ?    ?
?  ?    "createdAt": "2024-01-15T10:30:00Z",                          ?    ?
?  ?    "createdBy": "admin"                                            ?    ?
?  ?  }                                                                  ?    ?
?  ?                                                                      ?    ?
?  ?  ?? Message stored durably                                         ?    ?
?  ?  ?? Visibility timeout: 30 seconds                                ?    ?
?  ?  ?? Retention: 4 days                                             ?    ?
?  ?  ?? Dead Letter Queue (optional)                                  ?    ?
?  ??????????????????????????????????????????????????????????????????????    ?
???????????????????????????????????????????????????????????????????????????????
                                             ?
                                             ? Event Source Mapping
                                             ? Polls queue every few seconds
                                             ? Batch size: 10 messages
                                             ?
???????????????????????????????????????????????????????????????????????????????
?                         AWS LAMBDA FUNCTION                                  ?
?  ??????????????????????????????????????????????????????????????????????    ?
?  ?  Function: WifiQrProcessor                                         ?    ?
?  ?  Runtime: .NET 8                                                    ?    ?
?  ?  Memory: 512 MB                                                     ?    ?
?  ?  Timeout: 30 seconds                                               ?    ?
?  ?                                                                      ?    ?
?  ?  Processing Steps:                                                 ?    ?
?  ?  1. Receive SQS event (batch of messages)                         ?    ?
?  ?  2. For each message:                                              ?    ?
?  ?     ?? Deserialize JSON                                            ?    ?
?  ?     ?? Validate message format                                     ?    ?
?  ?     ?? Process WiFi QR data                                        ?    ?
?  ?     ?   ?? Send email notification                                ?    ?
?  ?     ?   ?? Update analytics database                              ?    ?
?  ?     ?   ?? Trigger external webhooks                              ?    ?
?  ?     ?   ?? Store in data warehouse                                ?    ?
?  ?     ?   ?? Log to CloudWatch                                      ?    ?
?  ?     ?? Return success                                              ?    ?
?  ?  3. SQS auto-deletes processed messages                           ?    ?
?  ?  4. Failed messages go to DLQ (if configured)                     ?    ?
?  ??????????????????????????????????????????????????????????????????????    ?
???????????????????????????????????????????????????????????????????????????????
                                             ?
                    ???????????????????????????????????????????????????
                    ?                        ?                        ?
                    ?                        ?                        ?
        ???????????????????????  ???????????????????????  ???????????????????????
        ?   Email Service     ?  ?   Analytics DB      ?  ?   CloudWatch Logs   ?
        ?   (SES/SendGrid)    ?  ?   (DynamoDB/RDS)    ?  ?   (Monitoring)      ?
        ?                     ?  ?                     ?  ?                     ?
        ?  - Send QR code     ?  ?  - Store metrics    ?  ?  - Application logs ?
        ?  - Notify admin     ?  ?  - Track usage      ?  ?  - Error tracking   ?
        ?  - User welcome     ?  ?  - Generate reports ?  ?  - Performance data ?
        ???????????????????????  ???????????????????????  ???????????????????????


????????????????????????????????????????????????????????????????????????????????
                            DATA FLOW TIMELINE
????????????????????????????????????????????????????????????????????????????????

Time    Action                          Component               Result
?????????????????????????????????????????????????????????????????????????????????
0ms     User clicks "Generate QR"       React Frontend          HTTP POST sent
                                                                 ?
50ms    Request received                .NET API                JWT validated
                                                                 ?
100ms   Validation passed               FluentValidation        Data validated
                                                                 ?
150ms   Save to database                Entity Framework        WiFi record created
                                                                 ?
200ms   Generate QR code                QrCodeService          PNG image created
                                                                 ?
250ms   Send to SQS                     SqsService             Message sent
                                                                 ?
260ms   Response to client              FastEndpoints          200 OK returned
                                                                 ?
                    ??????? API processing complete ???????
                    ?    (User sees success message)      ?
                    ???????????????????????????????????????
                                        ?
                    ?????? Async processing begins ???????
                    ?                                     ?
500ms   Message in queue                Amazon SQS             Stored durably
                                                                 ?
2-5s    Lambda triggered                AWS Lambda             Function invoked
                                                                 ?
3s      Process message                 Lambda Handler         Business logic runs
                                                                 ?
4s      Send email                      Email Service          Notification sent
                                                                 ?
5s      Update analytics                Analytics DB           Metrics stored
                                                                 ?
6s      Log completion                  CloudWatch             Success logged
                                                                 ?
7s      Delete message                  SQS                    Message removed


????????????????????????????????????????????????????????????????????????????????
                            CONFIGURATION
????????????????????????????????????????????????????????????????????????????????

??????????????????????????????????????????????????????????????????????????????
?  appsettings.json                                                           ?
??????????????????????????????????????????????????????????????????????????????
?  {                                                                          ?
?    "AWS": {                                                                 ?
?      "Profile": "default",              ? AWS credentials profile          ?
?      "Region": "us-east-1",             ? AWS region                       ?
?      "SQS": {                                                               ?
?        "QueueUrl": "https://...",       ? SQS queue URL                    ?
?        "EnableSqs": true                ? Feature toggle                   ?
?      }                                                                      ?
?    }                                                                        ?
?  }                                                                          ?
??????????????????????????????????????????????????????????????????????????????

??????????????????????????????????????????????????????????????????????????????
?  AWS IAM Permissions                                                        ?
??????????????????????????????????????????????????????????????????????????????
?                                                                             ?
?  .NET API Role:                                                             ?
?  ?? sqs:SendMessage                 ? Send messages to queue              ?
?  ?? sqs:GetQueueUrl                 ? Get queue URL                        ?
?                                                                             ?
?  Lambda Execution Role:                                                     ?
?  ?? sqs:ReceiveMessage              ? Read from queue                     ?
?  ?? sqs:DeleteMessage               ? Remove processed messages           ?
?  ?? sqs:GetQueueAttributes          ? Get queue info                      ?
?  ?? logs:CreateLogGroup             ? Create log groups                   ?
?  ?? logs:CreateLogStream            ? Create log streams                  ?
?  ?? logs:PutLogEvents               ? Write logs                          ?
??????????????????????????????????????????????????????????????????????????????


????????????????????????????????????????????????????????????????????????????????
                            ERROR HANDLING
????????????????????????????????????????????????????????????????????????????????

??????????????????????????????????????????????????????????????????????????????
?  Scenario: SQS Send Fails                                                   ?
??????????????????????????????????????????????????????????????????????????????
?  1. API saves WiFi to database          ? Success                          ?
?  2. API generates QR code               ? Success                          ?
?  3. API sends to SQS                    ? Fails                            ?
?  4. Error logged                        ? CloudWatch logs                  ?
?  5. Response still sent to user         ? 200 OK                           ?
?                                                                             ?
?  Result: User operation succeeds, async processing gracefully fails        ?
??????????????????????????????????????????????????????????????????????????????

??????????????????????????????????????????????????????????????????????????????
?  Scenario: Lambda Processing Fails                                         ?
??????????????????????????????????????????????????????????????????????????????
?  1. Message received from SQS           ? Success                          ?
?  2. Lambda processes message            ? Fails                            ?
?  3. Message visibility timeout expires  ? 30 seconds                      ?
?  4. Message returns to queue            ? Retry                            ?
?  5. Lambda retries up to 3 times        ???                               ?
?  6. If still fails ? Dead Letter Queue  ?? Manual review                   ?
??????????????????????????????????????????????????????????????????????????????


????????????????????????????????????????????????????????????????????????????????
                            SCALING & PERFORMANCE
????????????????????????????????????????????????????????????????????????????????

SQS Queue:
?? Throughput: Unlimited (Standard Queue)
?? Latency: < 10ms (send/receive)
?? Retention: 1 minute - 14 days
?? Batch operations: Up to 10 messages

Lambda Function:
?? Concurrent executions: 1000 (default, can increase)
?? Batch size: 1-10 messages per invocation
?? Cold start: ~1-2 seconds (first invocation)
?? Warm execution: ~50-200ms
?? Auto-scaling: Automatic based on queue depth

.NET API:
?? Connection pooling: Enabled
?? Async operations: Non-blocking
?? Timeout: 30 seconds (default)
?? Retry policy: AWS SDK handles retries


????????????????????????????????????????????????????????????????????????????????

```
